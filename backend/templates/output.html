<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Transaction Output - Expense Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        .card {
            border-radius: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .table-responsive {
            max-height: 500px;
            overflow-y: auto;
        }
        .badge-expense {
            background-color: #dc3545;
            color: white;
        }
        .badge-income {
            background-color: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h3 class="mb-0">
                            <i class="fas fa-file-invoice me-2"></i>Transaction Preview
                        </h3>
                        <div>
                            <span id="dateRangeDisplay" class="me-3"></span>
                            <button id="downloadPdfBtn" class="btn btn-light">
                                <i class="fas fa-download me-2"></i>Download PDF
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped" id="transactionTable">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Category</th>
                                        <th>Description</th>
                                        <th>Amount</th>
                                        <th>Type</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionTableBody">
                                    <!-- Transactions will be dynamically added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer text-center">
                        <button id="backToHistoryBtn" class="btn btn-secondary me-2">
                            <i class="fas fa-arrow-left me-2"></i>Back to History
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const { jsPDF } = window.jspdf;
            const startDate = localStorage.getItem('filterStartDate');
            const endDate = localStorage.getItem('filterEndDate');
            const dateRangeDisplay = document.getElementById('dateRangeDisplay');
            const tableBody = document.getElementById('transactionTableBody');
            const downloadPdfBtn = document.getElementById('downloadPdfBtn');
            const backToHistoryBtn = document.getElementById('backToHistoryBtn');

            // Display date range
            dateRangeDisplay.textContent = `${startDate} to ${endDate}`;

            // Sample transactions (in a real app, this would come from your backend)
            const allTransactions = [
                { date: '2024-06-15', category: 'Food', description: 'Restaurant Dinner', amount: 45.50, type: 'expense' },
                { date: '2024-06-14', category: 'Salary', description: 'Monthly Salary', amount: 2500.00, type: 'income' },
                { date: '2024-06-13', category: 'Transport', description: 'Fuel', amount: 30.25, type: 'expense' },
                { date: '2024-06-12', category: 'Utilities', description: 'Electricity Bill', amount: 120.75, type: 'expense' },
                { date: '2024-06-11', category: 'Entertainment', description: 'Movie Night', amount: 25.00, type: 'expense' }
            ];

            // Filter transactions based on date range
            const filteredTransactions = allTransactions.filter(transaction => {
                const transactionDate = new Date(transaction.date);
                return transactionDate >= new Date(startDate) && transactionDate <= new Date(endDate);
            });

            // Populate table
            filteredTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaction.date}</td>
                    <td>${transaction.category}</td>
                    <td>${transaction.description}</td>
                    <td>Rs ${transaction.amount.toFixed(2)}</td>
                    <td>
                        <span class="badge ${transaction.type === 'expense' ? 'badge-expense' : 'badge-income'}">
                            ${transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)}
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // PDF Download functionality
            downloadPdfBtn.addEventListener('click', function() {
                const doc = new jsPDF();
                
                // Add title and date range
                doc.setFontSize(16);
                doc.text('Transaction Report', 14, 22);
                doc.setFontSize(10);
                doc.text(`From: ${startDate} To: ${endDate}`, 14, 30);

                // Create table for PDF
                doc.autoTable({
                    startY: 40,
                    head: [['Date', 'Category', 'Description', 'Amount', 'Type']],
                    body: filteredTransactions.map(t => [
                        t.date, 
                        t.category, 
                        t.description, 
                        `Rs ${t.amount.toFixed(2)}`, 
                        t.type.charAt(0).toUpperCase() + t.type.slice(1)
                    ])
                });

                // Save PDF
                doc.save(`Transactions_${startDate}_to_${endDate}.pdf`);
            });

            // Back to History button
            backToHistoryBtn.addEventListener('click', function() {
                window.location.href = 'history.html';
            });
        });
    </script>
</body>
</html>